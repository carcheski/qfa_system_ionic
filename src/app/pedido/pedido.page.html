<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Categoria do Pedido</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" *ngIf="tipoTela == 1">
<ion-searchbar [debounce]="10000" (ionChange)="handleChangeCategoria($event)" clear-icon="trash-bin"
               placeholder="Nome"></ion-searchbar>
  <ion-list>
    <ion-item *ngFor="let item of categorias" [button]="true" (click)="showProdutos(item.id)">
      <ion-thumbnail item-start>
        <img src="{{bucketUrl}}/cat{{item.id}}.jpg">
      </ion-thumbnail>
      <h2> {{ item.nome }}</h2>
    </ion-item>
  </ion-list>
</ion-content>


<ion-content [fullscreen]="true" *ngIf="tipoTela == 2">
  <ion-list [inset]="true">
    <ion-item *ngFor="let item of produtos[0]" [button]="true"  (click)="addToCart(item)">
        <ion-thumbnail item-start>
          <img [src]="item.imageUrl || 'assets/imgs/prod.png'">
        </ion-thumbnail>
        <ion-card-content>
          <ion-card-title>
            {{item?.nome}}
          </ion-card-title>
          <p>
            {{item.preco | currency}}
          </p>
        </ion-card-content>
    </ion-item>
  </ion-list>
</ion-content>



<ion-content [fullscreen]="true" *ngIf="tipoTela == 3">
  <ion-list [inset]="true">
    <ion-item *ngFor="let item of carrinho">
      <ion-thumbnail slot="start">
        <img [src]="item.produto.imageUrl || 'assets/imgs/prod.jpg'">
      </ion-thumbnail>
      <ion-card-content >
        <ion-card-title style="font-weight: bold; font-size: 25px;">
          {{item?.produto.nome}}
        </ion-card-title>
        <h1>
          Vlr: {{item.produto.preco | currency}}
        </h1>
        <ion-label style="font-size: 25px;"> Qtd: {{item.quantidade}}
          <ion-icon size="large" name="remove-circle" color="primary"  (click)="decreaseQuantity(item.produto)"></ion-icon>
          <ion-icon size="large" name="add-circle" color="primary" (click)="increaseQuantity(item.produto)"></ion-icon>
          <ion-icon size="large" name="trash" item-end  color="danger" (click)="removeItem(item.produto)"></ion-icon>
        </ion-label>
      </ion-card-content>
    </ion-item>
    <ion-item *ngIf="total() > 0">
      <ion-label style="font-size: 25px;"> Total:  {{total() | currency}}</ion-label>
    </ion-item>
    <ion-item *ngIf="total() <= 0">
      <h1>Seu carrinho está vazio</h1>
    </ion-item>
  </ion-list>
  <ion-button expand="block" (click)="goOn()">Continuar comprando</ion-button>
  <ion-button *ngIf="total() > 0" color="success" expand="block" (click)="checkout()">Finalizar pedido</ion-button>
   
</ion-content>

<ion-content [fullscreen]="true" *ngIf="tipoTela == 4">
  <ion-list>
    <ion-item *ngFor="let item of clientes" [button]="true" (click)="showEnderecos(item.id)">
      <ion-thumbnail item-start>
        <img class="circle" [src]="usuario?.imageUrl || 'assets/imgs/avatar-blank.png'">
      </ion-thumbnail>
      <h2> {{ item.nome }}</h2>
    </ion-item>
  </ion-list>
</ion-content>

<ion-content [fullscreen]="true" *ngIf="tipoTela == 4">
  <ion-list>
    <ion-item *ngFor="let item of enderecos" [button]="true"  (click)="nextPage(item)">
      <ion-label>
        <h1>{{item.logradouro}}, {{item.numero}}</h1>
        <p>{{item.complemento}} {{item.bairro}} CEP {{item.cep}}</p>
        <p>{{item.cidade.nome}}, {{item.cidade.estado.nome}}</p>
      </ion-label>
    </ion-item>
  </ion-list>
</ion-content>

<ion-content [fullscreen]="true" *ngIf="tipoTela == 5">
  <form [formGroup]="formGroup" (ngSubmit)="nextPage(); $event.preventDefault()">
    <ion-radio-group formControlName="@type">
      <ion-item>
        <ion-label>Pagamento com cartão</ion-label>
        <ion-radio checked="true" value="debito"></ion-radio>
        <ion-radio checked="true" value="credito"></ion-radio>
      </ion-item>
      <ion-item>
        <ion-label>Marcar na Conta</ion-label>
        <ion-radio value="conta"></ion-radio>
      </ion-item>
    </ion-radio-group>

    <ion-item *ngIf="formGroup.value['@type'] == 'credito'">
      <ion-label stacked>Parcelas no boleto</ion-label>
      <ion-select formControlName="numeroDeParcelas">
        <ion-select-option *ngFor="let n of parcelas; first as f" [value]="n" [selected]="f">{{n}}</ion-select-option>
      </ion-select>
    </ion-item>
    <ion-button expand="block" type="submit" [disabled]="formGroup.invalid">Próximo</ion-button>
  </form>
</ion-content>

<ion-content [fullscreen]="true" *ngIf="tipoTela == 6">
  <div *ngIf="!codpedido">
    <ion-card>
      <ion-card-header style="text-align: center; font-weight: bold;font-size: 20px;">
        Itens do pedido
      </ion-card-header>

      <ion-list>
        <ion-item *ngFor="let item of cartItems">
          <ion-thumbnail slot="start">
            <img [src]="item.produto.imageUrl || 'assets/imgs/prod.jpg'">
          </ion-thumbnail>
          <ion-card-content >
            <ion-card-title style="font-weight: bold; font-size: 25px;">
              {{item?.produto.nome}}
            </ion-card-title>
            <h1>
              Vlr: {{item.produto.preco | currency}}
            </h1>
            <ion-label style="font-size: 25px;"> Qtd: {{item.quantidade}}
            </ion-label>
          </ion-card-content>
        </ion-item>

        <ion-item>
          <ion-label style="font-size: 25px;"> Total:  {{total()  | currency}}</ion-label>
        </ion-item>
      </ion-list> 
    </ion-card>

    <ion-card-content>
        <ion-card-title>
          Cliente
        </ion-card-title>
          <h1>{{cliente?.nome}}</h1>
          <ion-label>{{cliente?.email}}</ion-label>
    </ion-card-content>

    <ion-card-content>
      <ion-card-title>
        Endereço cliente
      </ion-card-title>

      <ion-label>
        <h1>{{endereco?.logradouro}}, {{endereco?.numero}}</h1>
        <p>{{endereco?.complemento}} {{endereco?.bairro}} CEP {{endereco?.cep}}</p>
        <p>{{endereco?.cidade.nome}}, {{endereco?.cidade.estado.nome}}</p>
      </ion-label>
    </ion-card-content>

    <ion-card-content>
      <ion-card-title>
        Forma de pagamento
      </ion-card-title>

      <ion-label *ngIf="pedido.pagamento['@type']==='pagamentoComCartao'">
        <h1>Pagamento com cartão</h1>
      </ion-label>
      <ion-label *ngIf="pedido.pagamento['@type']==='pagamentoComBoleto'">
        <h1>Pagamento com boleto</h1>
        <p>Parcelas: {{pedido.pagamento.numeroDeParcelas}}</p>
      </ion-label>
    </ion-card-content>

    <ion-button color="success" expand="block"  id="finalizar" (click)="checkout()"> Confirmar pedido
      <ion-icon slot="end" name="open"></ion-icon>
    </ion-button>

    <ion-button expand="block" fill="outline" id="finalizar" (click)="back()"> Voltar
      <ion-icon slot="end" name="open"></ion-icon>
    </ion-button>

  </div>

  <div *ngIf="codpedido">
    <ion-card>
        <ion-card-header>
          Seu pedido foi registrado!
        </ion-card-header>
        <ion-item>
          <h2>Código do pedido: {{codpedido}}</h2>
        </ion-item>
    </ion-card>

    <ion-button expand="block" fill="outline" id="finalizar" (click)="home()"> Voltar
      <ion-icon slot="end" name="open"></ion-icon>
    </ion-button>
  </div>

</ion-content>
